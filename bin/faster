#!/usr/bin/env node

var program  = require("commander"),
    config   = require("../lib/config").config;
    core     = require("../lib/core").core,
    log      = require("../lib/log").log;

program
  .version(core.version)
  .option("-b, --build",  "build a deployable version")
  .option("-t, --target", "specify a different target directory")
  .option("-s, --source", "specify a different source directory")
  .parse(process.argv);

config.appdir  =   program.source || config.appdir;
config.pubdir  =   program.target || config.pubdir;
config.devmode = !(program.build  || false);

var preamble = function() {
  log();
  log(2, "Source:", config.appdir);
  log(2, "Target:", config.pubdir);
  log();
};

var devmode = function() {
  preamble();
  log(1, "Development mode!");
  core.regen_all();
  core.watch();
};

var build = function() {
  preamble();
  log(1, "Building site!");
  core.regen_all();
};

(config.restart = config.devmode ? devmode : build)();