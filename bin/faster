#!/usr/bin/env node

var program  = require("commander");

program
  .version("0.0.0")
  .option("-d, --dev",    "development mode: auto-generate changed files")
  .option("-b, --build",  "build mode: build a complete version, with packed assets")
  .option("-t, --target", "specify a different target directory (default ../public)")
  .option("-f, --from",   "specify a different source directory (default current dir)")
  .option("-s, --server", "serve content from the target directory on localhost")
  .option("-p, --port",   "specify a different server port (default 3000)")
  .parse(process.argv);

if(!program.server && !program.dev && !program.build) {
  program.help();
}

var config   = require("../lib/config").config;
    core     = require("../lib/core").core,
    log      = require("../lib/log").log;
    server   = require("../lib/server").server;

config.override(program, [
  "source", "target", "port", "dev", "build", "server"
]);

var preamble = function() {
  log();
  log(2, "Source:", config.appdir);
  log(2, "Target:", config.pubdir);
  log();
};

var devmode = function() {
  preamble();
  log(1, "Development mode!");
  core.regen_all();
  core.watch();
};

var buildmode = function() {
  preamble();
  log(1, "Building site!");
  core.regen_all();
};

if(config.server) server.start(config);
if(config.dev && !config.build) devmode();
if(config.build) buildmode();
